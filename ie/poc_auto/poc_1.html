<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Example Tipo 2 - Bachelor - Pathway select or program picklist</title>
  </head>

  <body>
    <!-- Marketo form -->
    <script src="//402-ALY-118.mktoweb.com/js/forms2/js/forms2.min.js"></script>
    <form id="mktoForm_1236"></form>
    <script>
      MktoForms2.loadForm('//402-ALY-118.mktoweb.com', '402-ALY-118', 1236);
    </script>
    <!-- Marketo form -->

    <!-- Marketo form script -->
    <script>
      MktoForms2.whenReady(function (form) {
        const API_BASE =
          'https://publish-p147864-e1510969.adobeaemcloud.com/content/dam/ieprogram/json';

        const checkSelections = document.querySelectorAll(
          'input[type="radio"][name="mktoutilitycheck1"]'
        );

        /**
         * Fetch and populate programs into the program picklist based on the selected pathway.
         * @param {string} pathway - The selected pathway ID to filter programs.
         */
        const getProgramsByPathway = (pathway) => {
          const programPicklist = document.querySelector('#mkto_programoriginal');

          fetch(`${API_BASE}/programas.json`)
            .then((response) => response.json())
            .then(({ value: programs }) => {
              const filteredPrograms = programs.filter(
                (program) => program.parentproductid.productid === pathway
              );

              if (filteredPrograms.length > 0) {
                updatePicklist(programPicklist, filteredPrograms);
              } else {
                programPicklist.innerHTML = '<option value="">Select...</option>';
              }
            })
            .catch((error) => console.error(error));
        };

        /**
         * Fetch and populate programs into the program picklist based on an array of program IDs.
         * @param {Array} programs - An array of program IDs to filter programs.
         */
        const getProgramsById = (programs = []) => {
          const programPicklist = document.querySelector('#mkto_programoriginal');

          fetch(`${API_BASE}/programas.json`)
            .then((response) => response.json())
            .then(({ value: allPrograms }) => {
              // Filtra los programas que estÃ¡n en el array 'programs'
              const filteredPrograms = allPrograms.filter((program) =>
                programs.includes(program.productid)
              );

              if (filteredPrograms.length > 0) {
                updatePicklist(programPicklist, filteredPrograms);
              } else {
                programPicklist.innerHTML = '<option value="">Select...</option>';
              }
            })
            .catch((error) => console.error(error));
        };

        getProgramsByPathway();

        function updatePicklist(picklist, items) {
          picklist.innerHTML = '<option value="">Select...</option>';

          items.forEach((item) => {
            const id = item.id.replace(/[{}]/g, '');
            const name =
              item.attributes.find((attr) => attr.name === 'ie_name')?.value || 'Unknown';

            const option = document.createElement('option');
            option.value = id;
            option.textContent = name;
            picklist.appendChild(option);
          });
        }

        // Add change event listener to the checkSelection field
        checkSelections.forEach(function (radio) {
          radio.addEventListener('change', function () {
            const isSingle = this.value === 'single';

            form.vals({
              ie_pathwayid: isSingle ? '' : 'pathway-id',
              ie_interestedin: isSingle ? '' : 'unit-id',
            });

            console.log(form.vals());

            if (isSingle) {
              setTimeout(() => {
                getPrograms();
              }, 100);
            }
          });
        });

        form.onSuccess(function (values, followUpUrl) {
          console.log('Form submitted successfully:', values);
          return false; // Prevent default form submission
        });
      });
    </script>
  </body>
</html>
