<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script src="//402-ALY-118.mktoweb.com/js/forms2/js/forms2.min.js"></script>
    <form id="mktoForm_1349"></form>

    <script>
      MktoForms2.loadForm('//402-ALY-118.mktoweb.com', '402-ALY-118', 1349, function (form) {
        function loadScript(url) {
          return new Promise(function (resolve, reject) {
            const script = document.createElement('script');
            script.src = url;
            script.onload = () => resolve();
            script.onerror = () => reject(new Error(`Error al cargar el script: ${url}`));
            document.head.appendChild(script);
          });
        }

        const mktoFunctionsURL =
          'https://aem-publish.dev.ie.edu/content/dam/ieprogram/js-marketo/mktoFormFunctions.js?version=2';

        loadScript(mktoFunctionsURL)
          .then(() => {
            // codigo dinamismos
            const countryPicklist = document.getElementById('ie_countryid');
            const provincePicklist = document.getElementById('ie_provinceregionid');

            MktoForms2.whenReady(function (form) {
              getCountries();
              toggleVisibility(provincePicklist, false);

              countryPicklist.addEventListener('change', function () {
                const selectedCountry = this.value;
                if (selectedCountry) {
                  getProvinces(provincePicklist, selectedCountry);
                } else {
                  toggleVisibility(provincePicklist, false);
                }
              });
            });

            form.onSuccess(function (values, followUpUrl) {
              // Saca los datos del submit del form
              const params = {
                country: values.ie_countryid,
                province: values.ie_provinceregionid,
                gender: values.ie_genderidentity,
                interestedIn: values.ie_interestedin,
                pathwayId: values.ie_pathwayid,
                stakeholderRole: values.ie_stakeholdersroleid,
              };

              redirectToThankYouPage(params, followUpUrl);
              return false;
            });
          })
          .catch((error) => {
            console.error('Hubo un error al cargar el script de funciones:', error);
          });
      });
    </script>
  </body>
</html>
