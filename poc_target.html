<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PoC Target Profiles</title>

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        text-align: center;
        padding: 20px;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 360px;
        overflow: hidden;
      }

      .p-20 {
        padding: 20px;
      }

      h1 {
        font-size: 22px;
        margin-bottom: 10px;
      }

      .highlight {
        color: #0033cc;
        font-weight: bold;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      label {
        font-weight: bold;
        text-align: left;
      }

      select,
      input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      button {
        background-color: #0033cc;
        color: white;
        border: none;
        padding: 10px;
        margin-top: 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }

      button:hover {
        background-color: #002299;
      }

      .banner {
        width: 100%;
      }

      .hidden {
        display: none;
      }
    </style>

    <!-- Flicker script (oculta contenido antes de personalizar) -->
    <script>
      !(function (e, a, n, t) {
        var i = e.head;
        if (i) {
          if (a) return;
          var o = e.createElement("style");
          (o.id = "alloy-prehiding"),
            (o.innerText = n),
            i.appendChild(o),
            setTimeout(function () {
              o.parentNode && o.parentNode.removeChild(o);
            }, t);
        }
      })(
        document,
        document.location.href.indexOf("mboxEdit") !== -1,
        "body { opacity: 0 !important }",
        3000
      );
    </script>

    <!-- Script de Adobe Launch -->
    <script
      src="https://assets.adobedtm.com/27a87f218a28/d000d1a04f96/launch-1540681c5b7d-development.min.js"
      async
    ></script>

    <!-- SweetAlert para alertas -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <div class="container">
      <!-- Banner personalizado -->
      <img
        id="personalizedBanner"
        class="banner"
        src="https://cdn.aglty.io/scotiabank-colombia/Banner%20Prestamo%20Personal%20CFC%20900x400px%204may%20baja.jpg"
        alt="Banner"
      />

      <div class="p-20">
        <h1>Simula tu <span class="highlight">préstamo</span></h1>
        <p>
          Calcula el monto, el plazo y el número de quincenas que mejor se
          acomoden a tu estilo de vida.
        </p>

        <!-- Step 1 -->
        <form id="interestForm-step1">
          <label for="nombre">Nombre</label>
          <input type="text" id="nombre" name="nombre" value="" required />
          <button id="btnInterestFormStep1" type="submit">Siguiente</button>
        </form>

        <!-- Step 2 -->
        <form id="interestForm-step2" class="hidden">
          <h2>Bienvenido <span id="step2-nombre"></span></h2>

          <label for="montoPrestamoSimulado">¿Cuánto dinero necesitas?</label>
          <input
            type="number"
            id="montoPrestamoSimulado"
            name="montoPrestamoSimulado"
            required
          />

          <label for="plazoSimulado">¿Qué plazo quincenal quieres?</label>
          <select id="plazoSimulado" name="plazoSimulado">
            <option value="12">12</option>
            <option value="24" selected>24</option>
            <option value="36">36</option>
          </select>

          <button id="btnInterestFormStep2" type="submit">¡Me interesa!</button>
        </form>
      </div>
    </div>

    <script>
      window.adobeDataLayer = window.adobeDataLayer || [];
      window.adobeDataLayer.push({
        event: "pageLoad",
        page: {
          path: "/poc_target_profiles.html",
          name: "PoC Target Profiles",
          isHomePage: false,
          url: document.location.href,
        },
      });

      // Llamar a Target para Step 1
      window
        .alloy("sendEvent", {
          decisionScopes: ["offertSimuladorCredito"],
        })
        .then(function (result) {
          console.log("Oferta Step 1:", result.propositions);
        })
        .catch(console.error);

      // Función para cambiar al Step 2
      function goToStep2() {
        var nombre = document.getElementById("nombre").value;
        console.log("Step1: ", nombre);

        // Notificar a Adobe Target que el usuario pasó al Step 2
        windows.alloy("triggerView", { viewName: "Step2View" });

        // Llamar a Target para Step 2
        windows
          .alloy("sendEvent", {
            decisionScopes: ["offertSimuladorCredito"],
            xdm: {
              web: {
                webPageDetails: {
                  URL: window.location.href,
                },
              },
            },
            data: {
              __adobe: {
                target: {
                  "profile.nombre": nombre,
                },
              },
            },
          })
          .then(function (result) {
            console.log("Oferta Step 2:", result.propositions);

            if (result.propositions.length > 0) {
              var oferta = result.propositions[0].items[0].data;
              document.getElementById("personalizedBanner").src =
                oferta.bannerUrl;
              document.getElementById("step2-nombre").innerText = oferta.nombre;
            }
          })
          .catch(console.error);

        // Ocultar Step 1 y mostrar Step 2
        document.getElementById("interestForm-step1").classList.add("hidden");
        document
          .getElementById("interestForm-step2")
          .classList.remove("hidden");
      }

      // Botón para pasar al Step 2
      document
        .getElementById("btnInterestFormStep1")
        .addEventListener("click", function (e) {
          e.preventDefault();
          goToStep2();
        });

      // Botón del Step 2 con alert
      document
        .getElementById("btnInterestFormStep2")
        .addEventListener("click", function (e) {
          e.preventDefault();
          Swal.fire({
            title: "Gracias por preferirnos",
            text: "Tu simulación se ha realizado con éxito!",
            icon: "success",
          });
        });
    </script>
  </body>
</html>
