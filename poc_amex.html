<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <!--  -->
    <script
      src="https://assets.adobedtm.com/dcb19cbd6cbf/0a7da462a3cb/launch-d5b5108459af-development.min.js"
      async
    ></script>
  </head>
  <body>
    <input type="text" id="email" placeholder="Enter Email" />
    <button id="submit">Submit</button>

    <pre
      id="json-output"
      style="
        background: #f4f4f4;
        padding: 1em;
        border-radius: 5px;
        overflow: scroll;
        max-height: 100vh;
      "
    ></pre>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("submit")
          .addEventListener("click", function () {
            const email = document.getElementById("email").value;

            const data = {
              xdm: {
                identityMap: {
                  Email: [
                    {
                      id: email,
                      primary: true,
                    },
                  ],
                },
                _americanexpress: {
                  treatment: {
                    treatmentId: "1",
                  },
                },
                eventType: "web.webpagedetails.pageViews",
                web: {
                  wbePagedetails: {
                    URL: "https://example.com/",
                    name: "Home Page",
                  },
                },
              },
              data: {},
              renderDecisions: true,
              personalization: {
                surfaces: ["web://localhost#Test_Split"],
                schemas: [
                  "https://ns.adobe.com/personalization/default-content-item",
                  "https://ns.adobe.com/personalization/html-content-item",
                  "https://ns.adobe.com/personalization/json-content-item",
                  "https://ns.adobe.com/personalization/redirect-item",
                  "https://ns.adobe.com/personalization/dom-action",
                ],
              },
            };

            window.alloy("sendEvent", data).then((result) => {
              const decisions = result.propositions;

              decisions.forEach((decision) => {
                console.log("Placement (scope):", decision.scope);
                decision.items.forEach((item) => {
                  console.log(
                    "AJO-D Offer:",
                    item.data?.content[0] || "(no content)"
                  );
                });
              });
              document.getElementById("json-output").textContent =
                JSON.stringify(result, null, 2);
            });
          });

        setTimeout(function () {
          window
            .alloy("getIdentity")
            .then(function (result) {
              // The command succeeded.
              console.log("ECID:", result.identity.ECID);
              console.log("RegionId:", result.edge.regionId);
            })
            .catch(function (error) {
              // The command failed.
              // "error" will be an error object with additional information.
            });
        }, 300);
      });
    </script>
  </body>
</html>
