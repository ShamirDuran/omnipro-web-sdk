<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
      }

      h1,
      h2,
      h3,
      h4 {
        margin: 0px;
        margin-bottom: 10px;
      }
    </style>

    <style>
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        width: 80%;
        max-width: 500px;
        border-radius: 10px;
        padding: 25px 30px;
        display: flex;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        position: relative;
      }

      .modal-right {
        margin-top: 10px;
        flex: 1;
      }

      .modal-right form {
        display: flex;
        flex-direction: column;
      }

      .modal-right form label {
        margin: 10px 0 5px;
      }

      .modal-right form input,
      .modal-right form select,
      .modal-right form button {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      .modal-right form button {
        background-color: #000;
        color: #fff;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .modal-right form button:hover {
        background-color: #333;
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 26px;
        font-weight: 500;
        cursor: pointer;
        color: #000;
      }

      .close-btn:hover {
        color: #333;
        font-weight: 800;
      }

      .submit-button {
        margin-top: 10px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .mb-2 {
        margin-bottom: 20px;
      }

      .mb-1 {
        margin-bottom: 10px;
      }

      .metadata-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        gap: 10px;
      }

      .metadata-row input {
        width: 48%;
      }

      .add-metadata-btn {
        align-self: flex-start;
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f0f0f0;
        cursor: pointer;
      }

      .add-metadata-btn:hover {
        background-color: #e0e0e0;
      }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/uuid@11.0.5/dist/cjs-browser/index.min.js"></script>
  </head>

  <body>
    <div class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h1 style="align-self: center">Upload Asset</h1>
        <div class="modal-right">
          <form method="POST" enctype="multipart/form-data" id="asset-form">
            <div class="form-group mb-2">
              <h3>Propiedades</h3>

              <label for="folder">Folder</label>
              <select id="folder" required>
                <option value="" disabled selected>
                  Seleccione una opción
                </option>
              </select>
            </div>

            <!-- Logica para agregar custom metadata. Diseño debe ser doble columna, izquierda nombre metadata y derecha valor. Debe tener un botón para agregar nuevo e irlos apilando -->
            <div class="form-group mb-1" id="metadata-container">
              <h3>Metadata</h3>
              <div class="metadata-row">
                <input type="text" placeholder="Nombre" />
                <input type="text" placeholder="Valor" />
              </div>
            </div>

            <button
              type="button"
              class="add-metadata-btn"
              id="add-metadata-btn"
            >
              Agregar Metadata
            </button>

            <div class="form-group" style="margin-top: 20px">
              <h3>Cargar imagen</h3>
              <input type="file" id="images" accept="image/*" required />
            </div>

            <button class="submit-button" type="submit">Enviar →</button>
          </form>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        window.adobeDataLayer = window.adobeDataLayer || [];
        loadFolders();
      });

      document
        .querySelector(".close-btn")
        .addEventListener("click", function () {
          document.querySelector(".modal").style.display = "none";
        });

      document
        .getElementById("asset-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          sendHttpRequest();
        });

      document
        .getElementById("add-metadata-btn")
        .addEventListener("click", function () {
          const container = document.getElementById("metadata-container");
          const row = document.createElement("div");
          row.className = "metadata-row";
          row.innerHTML = `
            <input type="text" placeholder="Nombre" />
            <input type="text" placeholder="Valor" />
          `;
          container.appendChild(row);
        });

      document.getElementById("images").addEventListener("change", function () {
        const fileInput = document.getElementById("images");
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          const newFileName =
            crypto.randomUUID() + "." + file.name.split(".").pop();
        }
      });

      function loadFolders() {
        fetch("http://localhost:3000/api/assets/folders")
          .then((response) => response.json())
          .then((data) => {
            const folderSelect = document.getElementById("folder");
            data.forEach((folder) => {
              const option = document.createElement("option");
              option.value = folder.id;
              option.textContent = folder.name;
              folderSelect.appendChild(option);
            });
          })
          .catch((error) => {
            console.error("Error loading folders:", error);
          });
      }

      function sendHttpRequest() {
        const folder = document.getElementById("folder").value;
        const images = document.getElementById("images").files;

        const formData = new FormData();
        formData.append("folder", folder);

        const metadataContainer = document.getElementById("metadata-container");
        const metadataRows =
          metadataContainer.querySelectorAll(".metadata-row");
        metadataRows.forEach((row) => {
          const name = row.children[0].value;
          const value = row.children[1].value;
          if (name && value) {
            formData.append(`metadata[${name}]`, value);
          }
        });

        for (let i = 0; i < images.length; i++) {
          formData.append("images", images[i]);
        }

        fetch("http://localhost:3000/api/assets/", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>
  </body>
</html>
